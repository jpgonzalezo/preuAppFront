/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, ElementRef, Input, Output, EventEmitter, Renderer2, SecurityContext } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
/* tslint:disable-next-line */
/** @type {?} */
let showdown = require('showdown/dist/showdown.js');
export class TdMarkdownComponent {
    /**
     * @param {?} _renderer
     * @param {?} _elementRef
     * @param {?} _domSanitizer
     */
    constructor(_renderer, _elementRef, _domSanitizer) {
        this._renderer = _renderer;
        this._elementRef = _elementRef;
        this._domSanitizer = _domSanitizer;
        this._simpleLineBreaks = false;
        /**
         * contentReady?: function
         * Event emitted after the markdown content rendering is finished.
         */
        this.onContentReady = new EventEmitter();
    }
    /**
     * content?: string
     *
     * Markdown format content to be parsed as html markup.
     * Used to load data dynamically.
     *
     * e.g. README.md content.
     * @param {?} content
     * @return {?}
     */
    set content(content) {
        this._content = content;
    }
    /**
     * simpleLineBreaks?: string
     *
     * Sets whether newline characters inside paragraphs and spans are parsed as <br/>.
     * Defaults to false.
     * @param {?} simpleLineBreaks
     * @return {?}
     */
    set simpleLineBreaks(simpleLineBreaks) {
        this._simpleLineBreaks = simpleLineBreaks;
    }
    /**
     * @return {?}
     */
    ngOnChanges() {
        this.refresh();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (!this._content) {
            this._loadContent(((/** @type {?} */ (this._elementRef.nativeElement))).textContent);
        }
    }
    /**
     * @return {?}
     */
    refresh() {
        if (this._content) {
            this._loadContent(this._content);
        }
        else if (this._elementRef && !this._content) {
            this._loadContent(((/** @type {?} */ (this._elementRef.nativeElement))).textContent);
        }
    }
    /**
     * General method to parse a string markdown into HTML Elements and load them into the container
     * @param {?} markdown
     * @return {?}
     */
    _loadContent(markdown) {
        if (markdown && markdown.trim().length > 0) {
            // Clean container
            this._renderer.setProperty(this._elementRef.nativeElement, 'innerHTML', '');
            // Parse html string into actual HTML elements.
            /** @type {?} */
            let divElement = this._elementFromString(this._render(markdown));
        }
        this.onContentReady.emit();
    }
    /**
     * @param {?} markupStr
     * @return {?}
     */
    _elementFromString(markupStr) {
        // Renderer2 doesnt have a parsing method, so we have to sanitize and use [innerHTML]
        // to parse the string into DOM element for now.
        /** @type {?} */
        const div = this._renderer.createElement('div');
        this._renderer.appendChild(this._elementRef.nativeElement, div);
        div.innerHTML = this._domSanitizer.sanitize(SecurityContext.HTML, markupStr);
        return div;
    }
    /**
     * @param {?} markdown
     * @return {?}
     */
    _render(markdown) {
        // Trim leading and trailing newlines
        markdown = markdown.replace(/^(\s|\t)*\n+/g, '')
            .replace(/(\s|\t)*\n+(\s|\t)*$/g, '');
        // Split markdown by line characters
        /** @type {?} */
        let lines = markdown.split('\n');
        // check how much indentation is used by the first actual markdown line
        /** @type {?} */
        let firstLineWhitespace = lines[0].match(/^(\s|\t)*/)[0];
        // Remove all indentation spaces so markdown can be parsed correctly
        /** @type {?} */
        let startingWhitespaceRegex = new RegExp('^' + firstLineWhitespace);
        lines = lines.map(function (line) {
            return line.replace(startingWhitespaceRegex, '');
        });
        // Join lines again with line characters
        /** @type {?} */
        let markdownToParse = lines.join('\n');
        // Convert markdown into html
        /** @type {?} */
        let converter = new showdown.Converter();
        converter.setOption('ghCodeBlocks', true);
        converter.setOption('tasklists', true);
        converter.setOption('tables', true);
        converter.setOption('simpleLineBreaks', this._simpleLineBreaks);
        /** @type {?} */
        let html = converter.makeHtml(markdownToParse);
        return html;
    }
}
TdMarkdownComponent.decorators = [
    { type: Component, args: [{
                selector: 'td-markdown',
                template: "<ng-content></ng-content>",
                styles: [":host ::ng-deep a{background-color:transparent;-webkit-text-decoration-skip:objects;text-decoration:none}:host ::ng-deep a:active,:host ::ng-deep a:hover{outline-width:0;text-decoration:underline}:host ::ng-deep strong{font-weight:bolder}:host ::ng-deep h1{margin:.67em 0}:host ::ng-deep img{border-style:none;max-width:100%;box-sizing:content-box}:host ::ng-deep svg:not(:root){overflow:hidden}:host ::ng-deep code,:host ::ng-deep kbd,:host ::ng-deep pre{font-family:monospace,monospace;font-size:1em}:host ::ng-deep hr{box-sizing:content-box;height:0;overflow:hidden;background:0 0;border-bottom-width:1px;border-bottom-style:solid;margin:16px 0}:host ::ng-deep input{margin:0;overflow:visible;font:13px/1.4 Helvetica,arial,nimbussansl,liberationsans,freesans,clean,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\"}:host ::ng-deep [type=button]:-moz-focusring,:host ::ng-deep [type=reset]:-moz-focusring,:host ::ng-deep [type=submit]:-moz-focusring,:host ::ng-deep button:-moz-focusring{outline:ButtonText dotted 1px}:host ::ng-deep [type=checkbox]{box-sizing:border-box;padding:0}:host ::ng-deep table{border-spacing:0;border-collapse:collapse;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}:host ::ng-deep td,:host ::ng-deep th{padding:0}:host ::ng-deep *{box-sizing:border-box}:host ::ng-deep hr::before{display:table;content:\"\"}:host ::ng-deep hr::after{display:table;clear:both;content:\"\"}:host ::ng-deep p{margin-top:0;margin-bottom:10px}:host ::ng-deep blockquote{margin:0;padding:0 15px;border-left-width:4px;border-left-style:solid}:host ::ng-deep ol,:host ::ng-deep ul{margin-top:0;margin-bottom:0;padding-left:2em}:host ::ng-deep ol ol,:host ::ng-deep ul ol{list-style-type:lower-roman}:host ::ng-deep ol ol ol,:host ::ng-deep ol ul ol,:host ::ng-deep ul ol ol,:host ::ng-deep ul ul ol{list-style-type:lower-alpha}:host ::ng-deep dd{margin-left:0}:host ::ng-deep code{font-family:Consolas,\"Liberation Mono\",Menlo,Courier,monospace}:host ::ng-deep pre{margin-top:0;margin-bottom:0;font:12px Consolas,\"Liberation Mono\",Menlo,Courier,monospace;word-wrap:normal}:host ::ng-deep .pl-0{padding-left:0!important}:host ::ng-deep .pl-1{padding-left:3px!important}:host ::ng-deep .pl-2{padding-left:6px!important}:host ::ng-deep .pl-3{padding-left:12px!important}:host ::ng-deep .pl-4{padding-left:24px!important}:host ::ng-deep .pl-5{padding-left:36px!important}:host ::ng-deep .pl-6{padding-left:48px!important}:host ::ng-deep .form-select::-ms-expand{opacity:0}:host ::ng-deep a:not([href]){color:inherit;text-decoration:none}:host ::ng-deep h1,:host ::ng-deep h2,:host ::ng-deep h3,:host ::ng-deep h4,:host ::ng-deep h5,:host ::ng-deep h6{margin-top:1em;margin-bottom:16px;font-weight:700;line-height:1.4}:host ::ng-deep h1 .octicon-link,:host ::ng-deep h2 .octicon-link,:host ::ng-deep h3 .octicon-link,:host ::ng-deep h4 .octicon-link,:host ::ng-deep h5 .octicon-link,:host ::ng-deep h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}:host ::ng-deep h1:hover .anchor,:host ::ng-deep h2:hover .anchor,:host ::ng-deep h3:hover .anchor,:host ::ng-deep h4:hover .anchor,:host ::ng-deep h5:hover .anchor,:host ::ng-deep h6:hover .anchor{text-decoration:none}:host ::ng-deep h1:hover .anchor .octicon-link,:host ::ng-deep h2:hover .anchor .octicon-link,:host ::ng-deep h3:hover .anchor .octicon-link,:host ::ng-deep h4:hover .anchor .octicon-link,:host ::ng-deep h5:hover .anchor .octicon-link,:host ::ng-deep h6:hover .anchor .octicon-link{visibility:visible}:host ::ng-deep h1{padding-bottom:.3em;font-size:2.25em;line-height:1.2;border-bottom-width:1px;border-bottom-style:solid}:host ::ng-deep h1 .anchor{line-height:1}:host ::ng-deep h2{padding-bottom:.3em;font-size:1.75em;line-height:1.225;border-bottom-width:1px;border-bottom-style:solid}:host ::ng-deep h2 .anchor{line-height:1}:host ::ng-deep h3{font-size:1.5em;line-height:1.43}:host ::ng-deep h3 .anchor{line-height:1.2}:host ::ng-deep h4{font-size:1.25em}:host ::ng-deep h4 .anchor{line-height:1.2}:host ::ng-deep h5{font-size:1em}:host ::ng-deep h5 .anchor{line-height:1.1}:host ::ng-deep h6{font-size:1em}:host ::ng-deep h6 .anchor{line-height:1.1}:host ::ng-deep blockquote,:host ::ng-deep dl,:host ::ng-deep ol,:host ::ng-deep p,:host ::ng-deep pre,:host ::ng-deep table,:host ::ng-deep ul{margin-top:0;margin-bottom:16px}:host ::ng-deep ol ol,:host ::ng-deep ol ul,:host ::ng-deep ul ol,:host ::ng-deep ul ul{margin-top:0;margin-bottom:0}:host ::ng-deep li>p{margin-top:16px}:host ::ng-deep dl{padding:0}:host ::ng-deep dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}:host ::ng-deep dl dd{padding:0 16px;margin-bottom:16px}:host ::ng-deep blockquote>:first-child{margin-top:0}:host ::ng-deep blockquote>:last-child{margin-bottom:0}:host ::ng-deep table th{font-weight:700}:host ::ng-deep table td,:host ::ng-deep table th{padding:6px 13px;border-width:1px;border-style:solid}:host ::ng-deep table tr{border-top-width:1px;border-top-style:solid}:host ::ng-deep code{padding:.2em 0;margin:0;font-size:85%;border-radius:3px}:host ::ng-deep code:after,:host ::ng-deep code:before{letter-spacing:-.2em}:host ::ng-deep pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}:host ::ng-deep .highlight{margin-bottom:16px}:host ::ng-deep .highlight pre,:host ::ng-deep pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;border-radius:3px}:host ::ng-deep .highlight pre{margin-bottom:0;word-break:normal}:host ::ng-deep pre code{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}:host ::ng-deep pre code:after,:host ::ng-deep pre code:before{content:normal}:host ::ng-deep .pl-c{color:#969896}:host ::ng-deep .pl-c1,:host ::ng-deep .pl-s .pl-v{color:#0086b3}:host ::ng-deep .pl-e,:host ::ng-deep .pl-en{color:#795da3}:host ::ng-deep .pl-s .pl-s1,:host ::ng-deep .pl-smi{color:#333}:host ::ng-deep .pl-ent{color:#63a35c}:host ::ng-deep .pl-k{color:#a71d5d}:host ::ng-deep .pl-pds,:host ::ng-deep .pl-s,:host ::ng-deep .pl-s .pl-pse .pl-s1,:host ::ng-deep .pl-sr,:host ::ng-deep .pl-sr .pl-cce,:host ::ng-deep .pl-sr .pl-sra,:host ::ng-deep .pl-sr .pl-sre{color:#183691}:host ::ng-deep .pl-v{color:#ed6a43}:host ::ng-deep .pl-id{color:#b52a1d}:host ::ng-deep .pl-ii{background-color:#b52a1d;color:#f8f8f8}:host ::ng-deep .pl-sr .pl-cce{color:#63a35c;font-weight:700}:host ::ng-deep .pl-ml{color:#693a17}:host ::ng-deep .pl-mh,:host ::ng-deep .pl-mh .pl-en,:host ::ng-deep .pl-ms{color:#1d3e81;font-weight:700}:host ::ng-deep .pl-mq{color:teal}:host ::ng-deep .pl-mi{color:#333;font-style:italic}:host ::ng-deep .pl-mb{color:#333;font-weight:700}:host ::ng-deep .pl-md{background-color:#ffecec;color:#bd2c00}:host ::ng-deep .pl-mi1{background-color:#eaffea;color:#55a532}:host ::ng-deep .pl-mdr{color:#795da3;font-weight:700}:host ::ng-deep .pl-mo{color:#1d3e81}:host ::ng-deep kbd{display:inline-block;padding:3px 5px;font:11px/10px Consolas,\"Liberation Mono\",Menlo,Courier,monospace;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}:host ::ng-deep .full-commit .btn-outline:not(:disabled):hover{color:#4078c0;border:1px solid #4078c0}:host ::ng-deep :checked+.radio-label{position:relative;z-index:1;border-color:#4078c0}:host ::ng-deep .octicon{display:inline-block;vertical-align:text-top;fill:currentColor}:host ::ng-deep .task-list-item{list-style-type:none}:host ::ng-deep .task-list-item+.task-list-item{margin-top:3px}:host ::ng-deep .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}"]
            }] }
];
/** @nocollapse */
TdMarkdownComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef },
    { type: DomSanitizer }
];
TdMarkdownComponent.propDecorators = {
    content: [{ type: Input, args: ['content',] }],
    simpleLineBreaks: [{ type: Input, args: ['simpleLineBreaks',] }],
    onContentReady: [{ type: Output, args: ['contentReady',] }]
};
if (false) {
    /** @type {?} */
    TdMarkdownComponent.prototype._content;
    /** @type {?} */
    TdMarkdownComponent.prototype._simpleLineBreaks;
    /**
     * contentReady?: function
     * Event emitted after the markdown content rendering is finished.
     * @type {?}
     */
    TdMarkdownComponent.prototype.onContentReady;
    /** @type {?} */
    TdMarkdownComponent.prototype._renderer;
    /** @type {?} */
    TdMarkdownComponent.prototype._elementRef;
    /** @type {?} */
    TdMarkdownComponent.prototype._domSanitizer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2Rvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGNvdmFsZW50L21hcmtkb3duLyIsInNvdXJjZXMiOlsibWFya2Rvd24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFpQixVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUN6SSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7OztJQUlyRCxRQUFRLEdBQVEsT0FBTyxDQUFDLDJCQUEyQixDQUFDO0FBT3hELE1BQU0sT0FBTyxtQkFBbUI7Ozs7OztJQW1DOUIsWUFBb0IsU0FBb0IsRUFDcEIsV0FBdUIsRUFDdkIsYUFBMkI7UUFGM0IsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNwQixnQkFBVyxHQUFYLFdBQVcsQ0FBWTtRQUN2QixrQkFBYSxHQUFiLGFBQWEsQ0FBYztRQWxDdkMsc0JBQWlCLEdBQVksS0FBSyxDQUFDOzs7OztRQThCbkIsbUJBQWMsR0FBNEIsSUFBSSxZQUFZLEVBQWEsQ0FBQztJQUk5QyxDQUFDOzs7Ozs7Ozs7OztJQXhCbkQsSUFDSSxPQUFPLENBQUMsT0FBZTtRQUN6QixJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztJQUMxQixDQUFDOzs7Ozs7Ozs7SUFRRCxJQUNJLGdCQUFnQixDQUFDLGdCQUF5QjtRQUM1QyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsZ0JBQWdCLENBQUM7SUFDNUMsQ0FBQzs7OztJQVlELFdBQVc7UUFDVCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDakIsQ0FBQzs7OztJQUVELGVBQWU7UUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNsQixJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsbUJBQWEsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFh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YTtnQkFFdkIscUNBQXdDOzthQUN6Qzs7OztZQVgyRSxTQUFTO1lBQWxELFVBQVU7WUFDcEMsWUFBWTs7O3NCQXdCbEIsS0FBSyxTQUFDLFNBQVM7K0JBV2YsS0FBSyxTQUFDLGtCQUFrQjs2QkFTeEIsTUFBTSxTQUFDLGNBQWM7Ozs7SUEvQnRCLHVDQUF5Qjs7SUFDekIsZ0RBQTJDOzs7Ozs7SUE4QjNDLDZDQUFnRzs7SUFFcEYsd0NBQTRCOztJQUM1QiwwQ0FBK0I7O0lBQy9CLDRDQUFtQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQWZ0ZXJWaWV3SW5pdCwgRWxlbWVudFJlZiwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBSZW5kZXJlcjIsIFNlY3VyaXR5Q29udGV4dCwgT25DaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcblxuZGVjbGFyZSBjb25zdCByZXF1aXJlOiBhbnk7XG4vKiB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmUgKi9cbmxldCBzaG93ZG93bjogYW55ID0gcmVxdWlyZSgnc2hvd2Rvd24vZGlzdC9zaG93ZG93bi5qcycpO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0ZC1tYXJrZG93bicsXG4gIHN0eWxlVXJsczogWycuL21hcmtkb3duLmNvbXBvbmVudC5zY3NzJ10sXG4gIHRlbXBsYXRlVXJsOiAnLi9tYXJrZG93bi5jb21wb25lbnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIFRkTWFya2Rvd25Db21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQge1xuXG4gIHByaXZhdGUgX2NvbnRlbnQ6IHN0cmluZztcbiAgcHJpdmF0ZSBfc2ltcGxlTGluZUJyZWFrczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBjb250ZW50Pzogc3RyaW5nXG4gICAqXG4gICAqIE1hcmtkb3duIGZvcm1hdCBjb250ZW50IHRvIGJlIHBhcnNlZCBhcyBodG1sIG1hcmt1cC5cbiAgICogVXNlZCB0byBsb2FkIGRhdGEgZHluYW1pY2FsbHkuXG4gICAqXG4gICAqIGUuZy4gUkVBRE1FLm1kIGNvbnRlbnQuXG4gICAqL1xuICBASW5wdXQoJ2NvbnRlbnQnKVxuICBzZXQgY29udGVudChjb250ZW50OiBzdHJpbmcpIHtcbiAgICB0aGlzLl9jb250ZW50ID0gY29udGVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBzaW1wbGVMaW5lQnJlYWtzPzogc3RyaW5nXG4gICAqXG4gICAqIFNldHMgd2hldGhlciBuZXdsaW5lIGNoYXJhY3RlcnMgaW5zaWRlIHBhcmFncmFwaHMgYW5kIHNwYW5zIGFyZSBwYXJzZWQgYXMgPGJyLz4uXG4gICAqIERlZmF1bHRzIHRvIGZhbHNlLlxuICAgKi9cbiAgQElucHV0KCdzaW1wbGVMaW5lQnJlYWtzJylcbiAgc2V0IHNpbXBsZUxpbmVCcmVha3Moc2ltcGxlTGluZUJyZWFrczogYm9vbGVhbikge1xuICAgIHRoaXMuX3NpbXBsZUxpbmVCcmVha3MgPSBzaW1wbGVMaW5lQnJlYWtzO1xuICB9XG5cbiAgLyoqXG4gICAqIGNvbnRlbnRSZWFkeT86IGZ1bmN0aW9uXG4gICAqIEV2ZW50IGVtaXR0ZWQgYWZ0ZXIgdGhlIG1hcmtkb3duIGNvbnRlbnQgcmVuZGVyaW5nIGlzIGZpbmlzaGVkLlxuICAgKi9cbiAgQE91dHB1dCgnY29udGVudFJlYWR5Jykgb25Db250ZW50UmVhZHk6IEV2ZW50RW1pdHRlcjx1bmRlZmluZWQ+ID0gbmV3IEV2ZW50RW1pdHRlcjx1bmRlZmluZWQ+KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICAgICAgICAgICAgcHJpdmF0ZSBfZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgICAgICAgcHJpdmF0ZSBfZG9tU2FuaXRpemVyOiBEb21TYW5pdGl6ZXIpIHt9XG5cbiAgbmdPbkNoYW5nZXMoKTogdm9pZCB7XG4gICAgdGhpcy5yZWZyZXNoKCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLl9jb250ZW50KSB7XG4gICAgICB0aGlzLl9sb2FkQ29udGVudCgoPEhUTUxFbGVtZW50PnRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkudGV4dENvbnRlbnQpO1xuICAgIH1cbiAgfVxuXG4gIHJlZnJlc2goKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX2NvbnRlbnQpIHtcbiAgICAgIHRoaXMuX2xvYWRDb250ZW50KHRoaXMuX2NvbnRlbnQpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fZWxlbWVudFJlZiAmJiAhdGhpcy5fY29udGVudCkge1xuICAgICAgdGhpcy5fbG9hZENvbnRlbnQoKDxIVE1MRWxlbWVudD50aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpLnRleHRDb250ZW50KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhbCBtZXRob2QgdG8gcGFyc2UgYSBzdHJpbmcgbWFya2Rvd24gaW50byBIVE1MIEVsZW1lbnRzIGFuZCBsb2FkIHRoZW0gaW50byB0aGUgY29udGFpbmVyXG4gICAqL1xuICBwcml2YXRlIF9sb2FkQ29udGVudChtYXJrZG93bjogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKG1hcmtkb3duICYmIG1hcmtkb3duLnRyaW0oKS5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBDbGVhbiBjb250YWluZXJcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFByb3BlcnR5KHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ2lubmVySFRNTCcsICcnKTtcbiAgICAgIC8vIFBhcnNlIGh0bWwgc3RyaW5nIGludG8gYWN0dWFsIEhUTUwgZWxlbWVudHMuXG4gICAgICBsZXQgZGl2RWxlbWVudDogSFRNTERpdkVsZW1lbnQgPSB0aGlzLl9lbGVtZW50RnJvbVN0cmluZyh0aGlzLl9yZW5kZXIobWFya2Rvd24pKTtcbiAgICB9XG4gICAgdGhpcy5vbkNvbnRlbnRSZWFkeS5lbWl0KCk7XG4gIH1cblxuICBwcml2YXRlIF9lbGVtZW50RnJvbVN0cmluZyhtYXJrdXBTdHI6IHN0cmluZyk6IEhUTUxEaXZFbGVtZW50IHtcbiAgICAvLyBSZW5kZXJlcjIgZG9lc250IGhhdmUgYSBwYXJzaW5nIG1ldGhvZCwgc28gd2UgaGF2ZSB0byBzYW5pdGl6ZSBhbmQgdXNlIFtpbm5lckhUTUxdXG4gICAgLy8gdG8gcGFyc2UgdGhlIHN0cmluZyBpbnRvIERPTSBlbGVtZW50IGZvciBub3cuXG4gICAgY29uc3QgZGl2OiBIVE1MRGl2RWxlbWVudCA9IHRoaXMuX3JlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuX3JlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgZGl2KTtcbiAgICBkaXYuaW5uZXJIVE1MID0gdGhpcy5fZG9tU2FuaXRpemVyLnNhbml0aXplKFNlY3VyaXR5Q29udGV4dC5IVE1MLCBtYXJrdXBTdHIpO1xuICAgIHJldHVybiBkaXY7XG4gIH1cblxuICBwcml2YXRlIF9yZW5kZXIobWFya2Rvd246IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gVHJpbSBsZWFkaW5nIGFuZCB0cmFpbGluZyBuZXdsaW5lc1xuICAgIG1hcmtkb3duID0gbWFya2Rvd24ucmVwbGFjZSgvXihcXHN8XFx0KSpcXG4rL2csICcnKVxuICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvKFxcc3xcXHQpKlxcbisoXFxzfFxcdCkqJC9nLCAnJyk7XG4gICAgLy8gU3BsaXQgbWFya2Rvd24gYnkgbGluZSBjaGFyYWN0ZXJzXG4gICAgbGV0IGxpbmVzOiBzdHJpbmdbXSA9IG1hcmtkb3duLnNwbGl0KCdcXG4nKTtcblxuICAgIC8vIGNoZWNrIGhvdyBtdWNoIGluZGVudGF0aW9uIGlzIHVzZWQgYnkgdGhlIGZpcnN0IGFjdHVhbCBtYXJrZG93biBsaW5lXG4gICAgbGV0IGZpcnN0TGluZVdoaXRlc3BhY2U6IHN0cmluZyA9IGxpbmVzWzBdLm1hdGNoKC9eKFxcc3xcXHQpKi8pWzBdO1xuXG4gICAgLy8gUmVtb3ZlIGFsbCBpbmRlbnRhdGlvbiBzcGFjZXMgc28gbWFya2Rvd24gY2FuIGJlIHBhcnNlZCBjb3JyZWN0bHlcbiAgICBsZXQgc3RhcnRpbmdXaGl0ZXNwYWNlUmVnZXg6IFJlZ0V4cCA9IG5ldyBSZWdFeHAoJ14nICsgZmlyc3RMaW5lV2hpdGVzcGFjZSk7XG4gICAgbGluZXMgPSBsaW5lcy5tYXAoZnVuY3Rpb24obGluZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgIHJldHVybiBsaW5lLnJlcGxhY2Uoc3RhcnRpbmdXaGl0ZXNwYWNlUmVnZXgsICcnKTtcbiAgICB9KTtcblxuICAgIC8vIEpvaW4gbGluZXMgYWdhaW4gd2l0aCBsaW5lIGNoYXJhY3RlcnNcbiAgICBsZXQgbWFya2Rvd25Ub1BhcnNlOiBzdHJpbmcgPSAgbGluZXMuam9pbignXFxuJyk7XG5cbiAgICAvLyBDb252ZXJ0IG1hcmtkb3duIGludG8gaHRtbFxuICAgIGxldCBjb252ZXJ0ZXI6IGFueSA9IG5ldyBzaG93ZG93bi5Db252ZXJ0ZXIoKTtcbiAgICBjb252ZXJ0ZXIuc2V0T3B0aW9uKCdnaENvZGVCbG9ja3MnLCB0cnVlKTtcbiAgICBjb252ZXJ0ZXIuc2V0T3B0aW9uKCd0YXNrbGlzdHMnLCB0cnVlKTtcbiAgICBjb252ZXJ0ZXIuc2V0T3B0aW9uKCd0YWJsZXMnLCB0cnVlKTtcbiAgICBjb252ZXJ0ZXIuc2V0T3B0aW9uKCdzaW1wbGVMaW5lQnJlYWtzJywgdGhpcy5fc2ltcGxlTGluZUJyZWFrcyk7XG4gICAgbGV0IGh0bWw6IHN0cmluZyA9IGNvbnZlcnRlci5tYWtlSHRtbChtYXJrZG93blRvUGFyc2UpO1xuICAgIHJldHVybiBodG1sO1xuICB9XG5cbn1cbiJdfQ==