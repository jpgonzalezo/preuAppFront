/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, ɵReflectionCapabilities, Optional, SkipSelf, Self, Inject, inject, INJECTOR } from '@angular/core';
import { HttpHeaders } from '@angular/common/http';
import { TdHttpService } from '../interceptors/http.service';
import * as i0 from "@angular/core";
/**
 * @record
 */
export function ITdHttpRESTConfig() { }
if (false) {
    /** @type {?|undefined} */
    ITdHttpRESTConfig.prototype.baseHeaders;
    /** @type {?} */
    ITdHttpRESTConfig.prototype.baseUrl;
    /** @type {?|undefined} */
    ITdHttpRESTConfig.prototype.defaultObserve;
    /** @type {?|undefined} */
    ITdHttpRESTConfig.prototype.defaultResponseType;
}
/**
 * DO NOT MODIFY
 * Taken from angular since they dont expose this function
 * This is used internally to inject services from the constructor of the base service using the mixinHttp
 * \@internal
 * @param {?} types
 * @param {?} injector
 * @return {?}
 */
function injectArgs(types, injector) {
    /** @type {?} */
    var args = [];
    for (var i = 0; i < types.length; i++) {
        /** @type {?} */
        var arg = types[i];
        if (arg) {
            if (Array.isArray(arg)) {
                if (arg.length === 0) {
                    throw new Error('Arguments array must have arguments.');
                }
                /** @type {?} */
                var type = undefined;
                /** @type {?} */
                var flags = 0 /* Default */;
                for (var j = 0; j < arg.length; j++) {
                    /** @type {?} */
                    var meta = arg[j];
                    if (meta instanceof Optional || meta.ngMetadataName === 'Optional') {
                        /* tslint:disable */
                        flags |= 8 /* Optional */;
                    }
                    else if (meta instanceof SkipSelf || meta.ngMetadataName === 'SkipSelf') {
                        flags |= 4 /* SkipSelf */;
                    }
                    else if (meta instanceof Self || meta.ngMetadataName === 'Self') {
                        flags |= 2 /* Self */;
                    }
                    else if (meta instanceof Inject) {
                        type = meta.token;
                    }
                    else {
                        type = meta;
                    }
                    /* tslint:enable */
                }
                args.push(injector.get((/** @type {?} */ (type)), flags));
            }
            else {
                args.push(injector.get(arg));
            }
        }
    }
    return args;
}
/**
 * @return {?}
 */
export function getInjector() {
    try {
        return inject(INJECTOR);
    }
    catch (e) {
        if (!InternalHttpService._injector) {
            throw new Error('Please add CovalentHttpModule into your imports.');
        }
        return InternalHttpService._injector;
    }
}
/**
 * Mixin to augment a service with http helpers.
 * \@internal
 * @param {?} base
 * @param {?} config
 * @param {?=} httpInject
 * @return {?}
 */
export function mixinHttp(base, config, httpInject) {
    if (httpInject === void 0) { httpInject = TdHttpService; }
    /**
     * Internal class used to get an instance of Injector for internal usage plus also
     * a way to inject services from the constructor of the underlying service
     * \@internal
     * @abstract
     */
    var /**
     * Internal class used to get an instance of Injector for internal usage plus also
     * a way to inject services from the constructor of the underlying service
     * \@internal
     * @abstract
     */
    HttpInternalClass = /** @class */ (function (_super) {
        tslib_1.__extends(HttpInternalClass, _super);
        function HttpInternalClass() {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            var _this = _super.apply(this, tslib_1.__spread((args && args.length ? args : injectArgs(new ɵReflectionCapabilities().parameters(base), getInjector())))) || this;
            _this._injector = getInjector();
            _this.buildConfig();
            return _this;
        }
        return HttpInternalClass;
    }(base));
    if (false) {
        /**
         * @abstract
         * @return {?}
         */
        HttpInternalClass.prototype.buildConfig = function () { };
    }
    /**
     * Actuall class being returned with all the hooks for http usage
     * @internal
     */
    return /** @class */ (function (_super) {
        tslib_1.__extends(class_1, _super);
        function class_1() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        Object.defineProperty(class_1.prototype, "baseUrl", {
            get: /**
             * @return {?}
             */
            function () {
                return (typeof (this.basePath) === 'string' ?
                    this.basePath.replace(/\/$/, '') : '') + this._baseUrl;
            },
            enumerable: true,
            configurable: true
        });
        /**
         * Method used to setup the configuration parameters and get an instance of the http service
         */
        /**
         * Method used to setup the configuration parameters and get an instance of the http service
         * @return {?}
         */
        class_1.prototype.buildConfig = /**
         * Method used to setup the configuration parameters and get an instance of the http service
         * @return {?}
         */
        function () {
            this.http = this._injector.get(httpInject);
            this._baseUrl = config && config.baseUrl ? config.baseUrl.replace(/\/$/, '') : '';
            this._baseHeaders = config && config.baseHeaders ? config.baseHeaders : new HttpHeaders();
            this._defaultObserve = config && config.defaultObserve ? config.defaultObserve : 'body';
            this._defaultResponseType = config && config.defaultResponseType ? config.defaultResponseType : 'json';
        };
        /**
         * Method used to build the default headers using the base headers
         */
        /**
         * Method used to build the default headers using the base headers
         * @return {?}
         */
        class_1.prototype.buildHeaders = /**
         * Method used to build the default headers using the base headers
         * @return {?}
         */
        function () {
            var _this = this;
            /** @type {?} */
            var headersObj = {};
            this._baseHeaders.keys().forEach(function (key) {
                headersObj[key] = _this._baseHeaders.get(key);
            });
            return new HttpHeaders(headersObj);
        };
        /* tslint:disable-next-line */
        /* tslint:disable-next-line */
        /**
         * @template HttpResponse
         * @param {?} method
         * @param {?} url
         * @param {?=} options
         * @return {?}
         */
        class_1.prototype.buildRequest = /* tslint:disable-next-line */
        /**
         * @template HttpResponse
         * @param {?} method
         * @param {?} url
         * @param {?=} options
         * @return {?}
         */
        function (method, url, options) {
            return this._buildRequest(method, url, options);
        };
        /**
         * Method used to build the request depending on the `http` service and TdHttpMethod
         */
        /**
         * Method used to build the request depending on the `http` service and TdHttpMethod
         * @param {?} method
         * @param {?} url
         * @param {?=} options
         * @return {?}
         */
        class_1.prototype._buildRequest = /**
         * Method used to build the request depending on the `http` service and TdHttpMethod
         * @param {?} method
         * @param {?} url
         * @param {?=} options
         * @return {?}
         */
        function (method, url, options) {
            if (options === void 0) { options = {}; }
            if (!options.responseType) {
                options.responseType = this._defaultResponseType;
            }
            if (!options.observe) {
                options.observe = this._defaultObserve;
            }
            if (!options.headers) {
                options.headers = this.buildHeaders();
            }
            else {
                /** @type {?} */
                var headers_1 = this.buildHeaders();
                if (options.headers instanceof HttpHeaders) {
                    ((/** @type {?} */ (options.headers))).keys().forEach(function (key) {
                        headers_1 = headers_1.set(key, ((/** @type {?} */ (options.headers))).get(key));
                    });
                }
                else {
                    for (var key in options.headers) {
                        headers_1 = headers_1.set(key, (/** @type {?} */ (options.headers[key])));
                    }
                }
                options.headers = headers_1;
            }
            return ((/** @type {?} */ (this.http))).request(method, url, options);
        };
        return class_1;
    }(HttpInternalClass));
}
/**
 * \@internal
 * WORKAROUND until Ivy Renderer is ready
 */
var InternalHttpService = /** @class */ (function () {
    function InternalHttpService(_injector) {
        InternalHttpService._injector = _injector;
    }
    InternalHttpService._injector = undefined;
    InternalHttpService.decorators = [
        { type: Injectable, args: [{ providedIn: 'root' },] }
    ];
    /** @nocollapse */
    InternalHttpService.ctorParameters = function () { return [
        { type: Injector }
    ]; };
    /** @nocollapse */ InternalHttpService.ngInjectableDef = i0.defineInjectable({ factory: function InternalHttpService_Factory() { return new InternalHttpService(i0.inject(i0.INJECTOR)); }, token: InternalHttpService, providedIn: "root" });
    return InternalHttpService;
}());
export { InternalHttpService };
if (false) {
    /** @type {?} */
    InternalHttpService._injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC5taXhpbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bjb3ZhbGVudC9odHRwLyIsInNvdXJjZXMiOlsiYWN0aW9ucy9odHRwLm1peGluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFRLFVBQVUsRUFBRSxRQUFRLEVBQUUsdUJBQXVCLEVBQWUsUUFBUSxFQUNqRixRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBa0IsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNsRixPQUFPLEVBQWMsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDhCQUE4QixDQUFDOzs7OztBQU03RCx1Q0FLQzs7O0lBSkMsd0NBQTBCOztJQUMxQixvQ0FBZ0I7O0lBQ2hCLDJDQUFtQzs7SUFDbkMsZ0RBQTZDOzs7Ozs7Ozs7OztBQVcvQyxTQUFTLFVBQVUsQ0FBQyxLQUFnRCxFQUFFLFFBQWtCOztRQUNoRixJQUFJLEdBQVUsRUFBRTtJQUN0QixLQUFLLElBQUksQ0FBQyxHQUFXLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTs7WUFDdkMsR0FBRyxHQUFRLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDekIsSUFBSSxHQUFHLEVBQUU7WUFDUCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7Z0JBQ3RCLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7b0JBQ3BCLE1BQU0sSUFBSSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztpQkFDekQ7O29CQUNHLElBQUksR0FBd0IsU0FBUzs7b0JBQ3JDLEtBQUssa0JBQW1DO2dCQUU1QyxLQUFLLElBQUksQ0FBQyxHQUFXLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTs7d0JBQ3JDLElB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T0FBTyxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDbEUsQ0FBQztRQUNILGNBQUM7SUFBRCxDQUFDLEFBckVNLENBQWMsaUJBQWlCLEdBcUVwQztBQUNKLENBQUM7Ozs7O0FBTUQ7SUFLRSw2QkFBWSxTQUFtQjtRQUM3QixtQkFBbUIsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0lBQzVDLENBQUM7SUFKTSw2QkFBUyxHQUFhLFNBQVMsQ0FBQzs7Z0JBSHhDLFVBQVUsU0FBQyxFQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUM7Ozs7Z0JBN0tMLFFBQVE7Ozs4QkFBbkM7Q0FxTEMsQUFSRCxJQVFDO1NBUFksbUJBQW1COzs7SUFFOUIsOEJBQXVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHlwZSwgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIMm1UmVmbGVjdGlvbkNhcGFiaWxpdGllcywgSW5qZWN0RmxhZ3MsIE9wdGlvbmFsLFxuICBTa2lwU2VsZiwgU2VsZiwgSW5qZWN0LCBJbmplY3Rpb25Ub2tlbiwgaW5qZWN0LCBJTkpFQ1RPUiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEhlYWRlcnMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBUZEh0dHBTZXJ2aWNlIH0gZnJvbSAnLi4vaW50ZXJjZXB0b3JzL2h0dHAuc2VydmljZSc7XG5cbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgSVRkSHR0cFJFU1RPcHRpb25zLCBJVGRIdHRwUkVTVE9wdGlvbnNXaXRoQm9keSwgVGRIdHRwUkVTVFJlc3BvbnNlVHlwZSwgVGRIdHRwUkVTVE9ic2VydmUsIFRkSHR0cE1ldGhvZCB9IGZyb20gJy4uL2h0dHAuaW50ZXJmYWNlcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVRkSHR0cFJFU1RDb25maWcge1xuICBiYXNlSGVhZGVycz86IEh0dHBIZWFkZXJzO1xuICBiYXNlVXJsOiBzdHJpbmc7XG4gIGRlZmF1bHRPYnNlcnZlPzogVGRIdHRwUkVTVE9ic2VydmU7XG4gIGRlZmF1bHRSZXNwb25zZVR5cGU/OiBUZEh0dHBSRVNUUmVzcG9uc2VUeXBlO1xufVxuXG50eXBlIENvbnN0cnVjdG9yPFQ+ID0gbmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gVDtcblxuLyoqXG4gKiBETyBOT1QgTU9ESUZZXG4gKiBUYWtlbiBmcm9tIGFuZ3VsYXIgc2luY2UgdGhleSBkb250IGV4cG9zZSB0aGlzIGZ1bmN0aW9uXG4gKiBUaGlzIGlzIHVzZWQgaW50ZXJuYWxseSB0byBpbmplY3Qgc2VydmljZXMgZnJvbSB0aGUgY29uc3RydWN0b3Igb2YgdGhlIGJhc2Ugc2VydmljZSB1c2luZyB0aGUgbWl4aW5IdHRwXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gaW5qZWN0QXJncyh0eXBlczogKFR5cGU8YW55PnwgSW5qZWN0aW9uVG9rZW48YW55PnwgYW55W10pW10sIGluamVjdG9yOiBJbmplY3Rvcik6IGFueVtdIHtcbiAgY29uc3QgYXJnczogYW55W10gPSBbXTtcbiAgZm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IHR5cGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgYXJnOiBhbnkgPSB0eXBlc1tpXTtcbiAgICBpZiAoYXJnKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShhcmcpKSB7XG4gICAgICAgIGlmIChhcmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcmd1bWVudHMgYXJyYXkgbXVzdCBoYXZlIGFyZ3VtZW50cy4nKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdHlwZTogVHlwZTxhbnk+fHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgbGV0IGZsYWdzOiBJbmplY3RGbGFncyA9IEluamVjdEZsYWdzLkRlZmF1bHQ7XG5cbiAgICAgICAgZm9yIChsZXQgajogbnVtYmVyID0gMDsgaiA8IGFyZy5sZW5ndGg7IGorKykge1xuICAgICAgICAgIGNvbnN0IG1ldGE6IGFueSA9IGFyZ1tqXTtcbiAgICAgICAgICBpZiAobWV0YSBpbnN0YW5jZW9mIE9wdGlvbmFsIHx8IG1ldGEubmdNZXRhZGF0YU5hbWUgPT09ICdPcHRpb25hbCcpIHtcbiAgICAgICAgICAgIC8qIHRzbGludDpkaXNhYmxlICovXG4gICAgICAgICAgICBmbGFncyB8PSBJbmplY3RGbGFncy5PcHRpb25hbDtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1ldGEgaW5zdGFuY2VvZiBTa2lwU2VsZiB8fCBtZXRhLm5nTWV0YWRhdGFOYW1lID09PSAnU2tpcFNlbGYnKSB7XG4gICAgICAgICAgICBmbGFncyB8PSBJbmplY3RGbGFncy5Ta2lwU2VsZjtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1ldGEgaW5zdGFuY2VvZiBTZWxmIHx8IG1ldGEubmdNZXRhZGF0YU5hbWUgPT09ICdTZWxmJykge1xuICAgICAgICAgICAgZmxhZ3MgfD0gSW5qZWN0RmxhZ3MuU2VsZjtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1ldGEgaW5zdGFuY2VvZiBJbmplY3QpIHtcbiAgICAgICAgICAgIHR5cGUgPSBtZXRhLnRva2VuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0eXBlID0gbWV0YTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLyogdHNsaW50OmVuYWJsZSAqL1xuICAgICAgICB9XG5cbiAgICAgICAgYXJncy5wdXNoKGluamVjdG9yLmdldCh0eXBlICEsIGZsYWdzKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcmdzLnB1c2goaW5qZWN0b3IuZ2V0KGFyZykpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gYXJncztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEluamVjdG9yKCk6IEluamVjdG9yIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gaW5qZWN0KElOSkVDVE9SKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghSW50ZXJuYWxIdHRwU2VydmljZS5faW5qZWN0b3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUGxlYXNlIGFkZCBDb3ZhbGVudEh0dHBNb2R1bGUgaW50byB5b3VyIGltcG9ydHMuJyk7XG4gICAgfVxuICAgIHJldHVybiBJbnRlcm5hbEh0dHBTZXJ2aWNlLl9pbmplY3RvcjtcbiAgfVxufVxuXG4vKiogXG4gKiBNaXhpbiB0byBhdWdtZW50IGEgc2VydmljZSB3aXRoIGh0dHAgaGVscGVycy5cbiAqIEBpbnRlcm5hbFxuICovXG5leHBvcnQgZnVuY3Rpb24gbWl4aW5IdHRwKGJhc2U6IGFueSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnOiBJVGRIdHRwUkVTVENvbmZpZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cEluamVjdDogVHlwZTxIdHRwQ2xpZW50IHwgVGRIdHRwU2VydmljZT4gPSBUZEh0dHBTZXJ2aWNlKTogQ29uc3RydWN0b3I8YW55PiB7XG4gIC8qKlxuICAgKiBJbnRlcm5hbCBjbGFzcyB1c2VkIHRvIGdldCBhbiBpbnN0YW5jZSBvZiBJbmplY3RvciBmb3IgaW50ZXJuYWwgdXNhZ2UgcGx1cyBhbHNvXG4gICAqIGEgd2F5IHRvIGluamVjdCBzZXJ2aWNlcyBmcm9tIHRoZSBjb25zdHJ1Y3RvciBvZiB0aGUgdW5kZXJseWluZyBzZXJ2aWNlXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYWJzdHJhY3QgY2xhc3MgSHR0cEludGVybmFsQ2xhc3MgZXh0ZW5kcyBiYXNlIHtcbiAgICBjb25zdHJ1Y3RvciguLi5hcmdzOiBhbnlbXSkge1xuICAgICAgc3VwZXIoLi4uKGFyZ3MgJiYgYXJncy5sZW5ndGggPyBhcmdzIDogaW5qZWN0QXJncyhuZXcgybVSZWZsZWN0aW9uQ2FwYWJpbGl0aWVzKCkucGFyYW1ldGVycyhiYXNlKSwgZ2V0SW5qZWN0b3IoKSkpKTtcbiAgICAgIHRoaXMuX2luamVjdG9yID0gZ2V0SW5qZWN0b3IoKTtcbiAgICAgIHRoaXMuYnVpbGRDb25maWcoKTtcbiAgICB9XG4gICAgYWJzdHJhY3QgYnVpbGRDb25maWcoKTogdm9pZDtcbiAgfVxuICAvKipcbiAgICogQWN0dWFsbCBjbGFzcyBiZWluZyByZXR1cm5lZCB3aXRoIGFsbCB0aGUgaG9va3MgZm9yIGh0dHAgdXNhZ2VcbiAgICogQGludGVybmFsXG4gICAqL1xuICByZXR1cm4gY2xhc3MgZXh0ZW5kcyBIdHRwSW50ZXJuYWxDbGFzcyB7XG4gICAgcHJpdmF0ZSBfYmFzZVVybDogc3RyaW5nO1xuICAgIGdldCBiYXNlVXJsKCk6IHN0cmluZyB7XG4gICAgICByZXR1cm4gKHR5cGVvZih0aGlzLmJhc2VQYXRoKSA9PT0gJ3N0cmluZycgP1xuICAgICAgICB0aGlzLmJhc2VQYXRoLnJlcGxhY2UoL1xcLyQvLCAnJykgOiAnJykgKyB0aGlzLl9iYXNlVXJsO1xuICAgIH1cbiAgICBwcml2YXRlIF9iYXNlSGVhZGVyczogSHR0cEhlYWRlcnM7XG4gICAgcHJpdmF0ZSBfZGVmYXVsdE9ic2VydmU/OiBUZEh0dHBSRVNUT2JzZXJ2ZTtcbiAgICBwcml2YXRlIF9kZWZhdWx0UmVzcG9uc2VUeXBlPzogVGRIdHRwUkVTVFJlc3BvbnNlVHlwZTtcblxuICAgIGh0dHA6IEh0dHBDbGllbnQgfCBUZEh0dHBTZXJ2aWNlO1xuXG4gICAgLyoqXG4gICAgICogTWV0aG9kIHVzZWQgdG8gc2V0dXAgdGhlIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVycyBhbmQgZ2V0IGFuIGluc3RhbmNlIG9mIHRoZSBodHRwIHNlcnZpY2VcbiAgICAgKi9cbiAgICBidWlsZENvbmZpZygpOiB2b2lkIHtcbiAgICAgIHRoaXMuaHR0cCA9IHRoaXMuX2luamVjdG9yLmdldChodHRwSW5qZWN0KTtcbiAgICAgIHRoaXMuX2Jhc2VVcmwgPSBjb25maWcgJiYgY29uZmlnLmJhc2VVcmwgPyBjb25maWcuYmFzZVVybC5yZXBsYWNlKC9cXC8kLywgJycpIDogJyc7XG4gICAgICB0aGlzLl9iYXNlSGVhZGVycyA9IGNvbmZpZyAmJiBjb25maWcuYmFzZUhlYWRlcnMgPyBjb25maWcuYmFzZUhlYWRlcnMgOiBuZXcgSHR0cEhlYWRlcnMoKTtcbiAgICAgIHRoaXMuX2RlZmF1bHRPYnNlcnZlID0gY29uZmlnICYmIGNvbmZpZy5kZWZhdWx0T2JzZXJ2ZSA/IGNvbmZpZy5kZWZhdWx0T2JzZXJ2ZSA6ICdib2R5JztcbiAgICAgIHRoaXMuX2RlZmF1bHRSZXNwb25zZVR5cGUgPSBjb25maWcgJiYgY29uZmlnLmRlZmF1bHRSZXNwb25zZVR5cGUgPyBjb25maWcuZGVmYXVsdFJlc3BvbnNlVHlwZSA6ICdqc29uJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXRob2QgdXNlZCB0byBidWlsZCB0aGUgZGVmYXVsdCBoZWFkZXJzIHVzaW5nIHRoZSBiYXNlIGhlYWRlcnNcbiAgICAgKi9cbiAgICBidWlsZEhlYWRlcnMoKTogSHR0cEhlYWRlcnMge1xuICAgICAgbGV0IGhlYWRlcnNPYmo6IHtba2V5OiBzdHJpbmddOiBhbnl9ID0ge307XG4gICAgICB0aGlzLl9iYXNlSGVhZGVycy5rZXlzKCkuZm9yRWFjaCgoa2V5OiBhbnkpID0+IHtcbiAgICAgICAgaGVhZGVyc09ialtrZXldID0gdGhpcy5fYmFzZUhlYWRlcnMuZ2V0KGtleSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBuZXcgSHR0cEhlYWRlcnMoaGVhZGVyc09iaik7XG4gICAgfVxuICAgIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZSAqL1xuICAgIGJ1aWxkUmVxdWVzdDxIdHRwUmVzcG9uc2U+KG1ldGhvZDogJ1BPU1QnIHwgJ1BVVCcgfCAnUEFUQ0gnLCB1cmw6IHN0cmluZywgb3B0aW9ucz86IElUZEh0dHBSRVNUT3B0aW9uc1dpdGhCb2R5KTogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U+O1xuICAgIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZSAqL1xuICAgIGJ1aWxkUmVxdWVzdDxIdHRwUmVzcG9uc2U+KG1ldGhvZDogJ0dFVCcgfCAnREVMRVRFJywgdXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBJVGRIdHRwUkVTVE9wdGlvbnMpOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZT47XG4gICAgLyogdHNsaW50OmRpc2FibGUtbmV4dC1saW5lICovXG4gICAgYnVpbGRSZXF1ZXN0PEh0dHBSZXNwb25zZT4obWV0aG9kOiBUZEh0dHBNZXRob2QsIHVybDogc3RyaW5nLCBvcHRpb25zPzogSVRkSHR0cFJFU1RPcHRpb25zV2l0aEJvZHkpOiBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZT4ge1xuICAgICAgcmV0dXJuIHRoaXMuX2J1aWxkUmVxdWVzdChtZXRob2QsIHVybCwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWV0aG9kIHVzZWQgdG8gYnVpbGQgdGhlIHJlcXVlc3QgZGVwZW5kaW5nIG9uIHRoZSBgaHR0cGAgc2VydmljZSBhbmQgVGRIdHRwTWV0aG9kXG4gICAgICovXG4gICAgcHJpdmF0ZSBfYnVpbGRSZXF1ZXN0KG1ldGhvZDogVGRIdHRwTWV0aG9kLCB1cmw6IHN0cmluZywgb3B0aW9uczogSVRkSHR0cFJFU1RPcHRpb25zV2l0aEJvZHkgPSB7fSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgICBpZiAoIW9wdGlvbnMucmVzcG9uc2VUeXBlKSB7XG4gICAgICAgIG9wdGlvbnMucmVzcG9uc2VUeXBlID0gdGhpcy5fZGVmYXVsdFJlc3BvbnNlVHlwZTtcbiAgICAgIH1cbiAgICAgIGlmICghb3B0aW9ucy5vYnNlcnZlKSB7XG4gICAgICAgIG9wdGlvbnMub2JzZXJ2ZSA9IHRoaXMuX2RlZmF1bHRPYnNlcnZlO1xuICAgICAgfVxuICAgICAgaWYgKCFvcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgICAgb3B0aW9ucy5oZWFkZXJzID0gdGhpcy5idWlsZEhlYWRlcnMoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBoZWFkZXJzOiBIdHRwSGVhZGVycyA9IHRoaXMuYnVpbGRIZWFkZXJzKCk7XG4gICAgICAgIGlmIChvcHRpb25zLmhlYWRlcnMgaW5zdGFuY2VvZiBIdHRwSGVhZGVycykge1xuICAgICAgICAgICg8SHR0cEhlYWRlcnM+b3B0aW9ucy5oZWFkZXJzKS5rZXlzKCkuZm9yRWFjaCgoa2V5OiBhbnkpID0+IHtcbiAgICAgICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldChrZXksICg8SHR0cEhlYWRlcnM+b3B0aW9ucy5oZWFkZXJzKS5nZXQoa2V5KSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZm9yIChsZXQga2V5IGluIG9wdGlvbnMuaGVhZGVycykge1xuICAgICAgICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KGtleSwgPGFueT5vcHRpb25zLmhlYWRlcnNba2V5XSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG9wdGlvbnMuaGVhZGVycyA9IGhlYWRlcnM7XG4gICAgICB9XG4gICAgICByZXR1cm4gKDxUZEh0dHBTZXJ2aWNlPnRoaXMuaHR0cCkucmVxdWVzdChtZXRob2QsIHVybCwgb3B0aW9ucyk7XG4gICAgfVxuICB9O1xufVxuXG4vKiogXG4gKiBAaW50ZXJuYWxcbiAqIFdPUktBUk9VTkQgdW50aWwgSXZ5IFJlbmRlcmVyIGlzIHJlYWR5XG4gKi9cbkBJbmplY3RhYmxlKHtwcm92aWRlZEluOiAncm9vdCd9KVxuZXhwb3J0IGNsYXNzIEludGVybmFsSHR0cFNlcnZpY2Uge1xuXG4gIHN0YXRpYyBfaW5qZWN0b3I6IEluamVjdG9yID0gdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yKF9pbmplY3RvcjogSW5qZWN0b3IpIHtcbiAgICBJbnRlcm5hbEh0dHBTZXJ2aWNlLl9pbmplY3RvciA9IF9pbmplY3RvcjtcbiAgfVxufVxuIl19